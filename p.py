import os
import re
import asyncio
from telethon import TelegramClient, events
from telethon.tl.functions.channels import EditBannedRequest
from telethon.tl.types import ChatBannedRights

# Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¨ÙŠØ¦Ø©
api_id = int(os.getenv('API_ID'))      
api_hash = os.getenv('API_HASH')  
bot_token = os.getenv('BOT_TOKEN') 

# ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨ÙˆØª
ABH = TelegramClient('bot', api_id, api_hash).start(bot_token=bot_token)

# Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø­Ø¸ÙˆØ±Ø©
banned_words = [
    "Ø³Ø¨", "ÙƒØ³", "Ø¹ÙŠØ±", "ÙƒØ³Ù…Ùƒ", "ÙƒØ³Ø®ØªÙƒ", "ÙƒØ³ Ø§Ù…Ùƒ", "Ø·ÙŠØ²", "Ø·ÙŠØ²Ùƒ", "ÙØ±Ø®", "ÙƒÙˆØ§Ø¯", 
    "Ø§Ù†ÙŠØ¬Ùƒ", "Ù†ÙŠØ¬Ùƒ", "ÙƒØ­Ø¨Ø©", "Ø§Ø¨Ù† Ø§Ù„ÙƒØ­Ø¨Ø©", "Ø§Ø¨Ù† Ø§Ù„ÙƒØ­Ø¨Ù‡", "ØªÙ†ÙŠØ¬", "Ø§ØªÙ†ÙŠØ¬", "ÙŠÙ†ÙŠØ¬", 
    "Ø§ÙŠÙ†ÙŠØ¬", "Ø¨Ø±Ø¨ÙˆÙƒ", "Ø²Ø¨", "Ø·ÙŠØ²Ù‡Ø§", "Ø¹ÙŠØ±ÙŠ", "Ø®Ø±Ø¨ Ø§Ù„Ù„Ù‡", "Ø§Ù„Ø¹ÙŠØ±", "Ø¨Ø¹ÙŠØ±ÙŠ", "ÙƒØ­Ø¨Ù‡", 
    "Ø¨Ø±Ø§Ø¨ÙŠÙƒ", "Ù†ÙŠØ¬Ù†ÙŠ", "Ù†ÙŠÚ†Ù†ÙŠ", "Ù†ÙˆØ¯Ø²", "Ù†ØªÙ„Ø§ÙˆØ·", "Ù„ÙˆØ§Ø·", "Ù„ÙˆØ·ÙŠ", "ÙØ±ÙˆØ®", "Ù…Ù†ÙŠÙˆÙƒ", 
    "Ù…Ø§ÙŠØ§", "Ù…Ø§ÙŠØ©", "Ù…Ø§ÙŠÙ‡", "Ø¨ÙƒØ³Ù…Ùƒ", "Ø¨ÙƒØ³Ø®ØªÙƒ", "ğŸ‘", "Ù†ØºÙ„", "Ù†ØºÙˆÙ„Ø©", "Ù†ØºÙˆÙ„Ù‡", "ÙŠÙ†ØºÙ„", 
    "Ø³ÙƒØ³ÙŠ", "ÙƒØ­Ø§Ø¨", "Ù…Ù†Ø§ÙˆÙŠØ¬", "Ù…Ù†ÙŠÙˆØ¬", "Ø¹ÙŠÙˆØ±Ø©", "Ø¹ÙŠÙˆØ±ØªÙƒÙ…", "Ø§Ù†ÙŠØ¬Ø©", "Ø§Ù†ÙŠÚ†Ø©", "Ø§Ù†ÙŠØ¬Ù‡", 
    "Ø§Ù†ÙŠÚ†Ù‡", "Ø£Ù†Ø§Ø¬", "Ø§Ù†Ø§Ø¬", "Ø§Ù†ÙŠØ¬", "Ø£Ù†ÙŠØ¬", "ÙØ±ÙŠØ®", "ÙØ±ÙŠØ®Ø©", "ÙØ±ÙŠØ®Ù‡", "ÙØ±Ø®ÙŠ", "ğŸ†", 
    "ğŸ–•", "ÙƒØ³Ùƒ", "ÙƒØ³Ù‡", "ÙƒØ³Ø©", "Ø§ÙƒØ­Ø§Ø¨", "Ø£ÙƒØ­Ø§Ø¨", "Ø²Ù†Ø§", "ÙƒÙˆÙ… Ø¨ÙŠ", "ÙƒÙ…Ø¨ÙŠ", "Ø§Ø±Ù‚Ø© Ø¬Ø§ÙŠ", 
    "Ø§Ø±Ù‚Ù‡ Ø¬Ø§ÙŠ", "ÙŠÙ…ÙˆØ·", "ØªÙ…ÙˆØ·", "Ù…ÙˆØ·Ù„ÙŠ", "Ø§Ù…ÙˆØ·", "Ø¨ÙˆØ±Ù†", "Ø§Ù„ÙØ±Ø®", "Ø§Ù„ÙØ±Ø­Ù’", "ØªÙŠØ²", "ÙƒØ³Ù…"
]

def normalize_text(text):
    """Ø¥Ø²Ø§Ù„Ø© ÙƒÙ„ Ø´ÙŠØ¡ Ø¹Ø¯Ø§ Ø§Ù„Ø£Ø­Ø±Ù Ù…Ø¹ Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙˆØ§Ù„Ø­Ø±ÙˆÙ 'Ù€' Ùˆ 'Ù‰'"""
    text = re.sub(r'[^Ø£-ÙŠa-zA-Z]', '', text)
    remove_chars = ['Ù¾', 'Ú¤', 'Ù‡Ù€', 'Ú†', 'Ú¯', 'Ø£', 'Ø¥', 'Ø¢', 'Ø¦', 'Ú˜']
    for char in remove_chars:
        text = text.replace(char, '')
    text = text.replace('Ù€', '')
    text = text.replace('Ù‰', '')
    text = re.sub(r'(.)\1+', r'\1', text)
    return text

def check_message(message):
    """Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø±Ø³Ø§Ù„Ø© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ÙƒÙ„Ù…Ø© Ù…Ø­Ø¸ÙˆØ±Ø© Ø­ØªÙ‰ Ù„Ùˆ ÙƒØ§Ù† ÙÙŠÙ‡Ø§ Ø­Ø±ÙˆÙ Ù…ÙƒØ±Ø±Ø©"""
    words = message.split()
    normalized_words = [normalize_text(word) for word in words]
    for word in normalized_words:
        if "Ù‰" * 3 in word:  # Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„ÙƒÙ„Ù…Ø© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù‰Ù‰Ù‰
            return True
    for banned_word in banned_words:
        if normalize_text(banned_word) in normalized_words:
            return True
    return False

@ABH.on(events.NewMessage)
async def handler(event):
    """Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„"""
    if event.is_group:
        if event.raw_text.startswith('#'):
            new_word = event.raw_text[1:].strip()
            if new_word not in banned_words:
                banned_words.append(new_word)
                await event.reply(f"âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒÙ„Ù…Ø© '{new_word}' Ø¥Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø­Ø¸ÙˆØ±Ø©!")
        
        elif check_message(event.raw_text):
            user_id = event.sender_id
            warning_msg = "ğŸš¨ **ØªØ­Ø°ÙŠØ±:** Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙƒÙ„Ù…Ø§Øª Ù…Ø­Ø¸ÙˆØ±Ø© ÙÙŠ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©! ğŸš«"
            await event.reply(warning_msg)

# Ø­Ù‚ÙˆÙ‚ Ø§Ù„ØªÙ‚ÙŠÙŠØ¯ ÙˆØ±ÙØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚
restrict_rights = ChatBannedRights(
    until_date=None, 
    send_messages=True,  
    send_media=True,
    send_stickers=True,
    send_gifs=True,
    send_games=True,
    send_inline=True,
    embed_links=True
)

unrestrict_rights = ChatBannedRights(
    until_date=None,  
    send_messages=False,  
    send_media=False,
    send_stickers=False,
    send_gifs=False,
    send_games=False,
    send_inline=False,
    embed_links=False
)

@ABH.on(events.ChatAction)
async def auto_unrestrict(event):
    try:
        if event.user_kicked:
            user = await event.get_user()
            chat = await event.get_chat()
            await ABH(EditBannedRequest(chat.id, user.id, unrestrict_rights))
            await event.reply(f"ğŸš« ØªÙ… Ø·Ø±Ø¯ {user.first_name} Ù…Ù† Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©.")
        
        if hasattr(event.original_update, 'banned_rights'):
            if event.original_update.banned_rights:
                user = await event.get_user()
                chat = await event.get_chat()
                await ABH(EditBannedRequest(chat.id, user.id, restrict_rights))
                await event.reply(f"ğŸš« ØªÙ… ØªÙ‚ÙŠÙŠØ¯ {user.first_name}.")
                await asyncio.sleep(3)
                await ABH(EditBannedRequest(chat.id, user.id, unrestrict_rights))
                await event.reply(f"âœ… ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØµÙ„Ø§Ø­ÙŠØ§Øª {user.first_name}.")

    except Exception as e:
        print(f"Ø®Ø·Ø£: {e}")

# ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨ÙˆØª
print("âœ… Ø§Ù„Ø¨ÙˆØª Ø´ØºØ§Ù„ ÙˆÙŠÙ†ØªØ¸Ø± Ø§Ù„Ø±Ø³Ø§Ø¦Ù„...")
ABH.run_until_disconnected()
